<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>PSEmailRep PowerShell Module | My Website</title>
<meta name="keywords" content="">
<meta name="description" content="Using the PSEmailRep PowerShell Module">
<meta name="author" content="Kyle Parrish">
<link rel="canonical" href="http://localhost:1313/posts/test/">
<link crossorigin="anonymous" href="http://localhost:1313/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css" integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/test/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="My Website (Alt + H)">My Website</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/posts/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      PSEmailRep PowerShell Module
    </h1>
    <div class="post-description">
      Using the PSEmailRep PowerShell Module
    </div>
    <div class="post-meta"><span title='2020-02-08 00:00:00 +0000 UTC'>February 8, 2020</span>&nbsp;·&nbsp;Kyle Parrish

</div>
  </header> 
  <div class="post-content"><h1 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h1>
<p>Hey! Kyle here. I recently released a small update to one of the PowerShell modules I put together to interact with EmailRep&rsquo;s API and thought I would share a little about what it is and why I built it.</p>
<ul>
<li><a href="https://github.com/arnydo/psemailrep">Github</a></li>
<li><a href="https://www.powershellgallery.com/packages/psemailrep">PowerShellGallery</a></li>
</ul>
<p><img alt="PSEmailRep" loading="lazy" src="https://github.com/arnydo/PSEmailRep/raw/master/Media/screenshot.png"></p>
<p>First of all, if you work in Information Security or IT in general, be sure to check out <a href="https://emailrep.io">EmailRep.io</a>. This is an excellent service built by a great group of people to provide enrichment data about an email address. Nearly all of our online interactions these days link back to an email address and it is important that we observe the &ldquo;reputation&rdquo; of email addresses that are used to interact with our systems.</p>
<p>Here is a brief description of EmailRep by the EmailRep team:</p>
<p><em>EmailRep uses hundreds of factors like domain age, traffic rankings, presence on social media sites, professional networking sites, personal connections, public records, deliverability, data breaches, dark web credential leaks, phishing emails, threat actor emails, and more to answer these types of questions:</em></p>
<ul>
<li><em>Is this email risky?</em></li>
<li><em>Is this a throwaway account?</em></li>
<li><em>What kind of online presence does this email have?</em></li>
<li><em>Is this a trustworthy sender?</em></li>
</ul>
<h1 id="psemailrep">PSEmailRep<a hidden class="anchor" aria-hidden="true" href="#psemailrep">#</a></h1>
<h2 id="goals">Goals<a hidden class="anchor" aria-hidden="true" href="#goals">#</a></h2>
<p>After using EmailRep for a short time I quickly realized the value that it would add to my daily routines of triaging phishing emails and maintaing the many security aspects of our environment. With PowerShell being my daily-driver for automation and security tools I decided to put together a module that would interact with the EmailRep API. Seeing that nobody else at the time had been working on one I figured it would be a good project to start and share with the community. Some of the things that I was looking to accomplish were:</p>
<ul>
<li>Maintained in a Github repo</li>
<li>Published to PowerShellGallery</li>
<li>Helpful documentation on the available features</li>
<li>Deployment pipeline</li>
</ul>
<p>Keep an eye out for a follow-up post on how I tackled these points. I learned a ton about building a module template with <a href="https://github.com/PowerShell/Plaster">Plaster</a>, running various checks with <a href="https://github.com/pester/Pester">Pester</a>, and preparing it to be pushed out to a central repository such as PowerShellGallery with <a href="https://github.com/RamblingCookieMonster/PSDeploy">PSDeploy</a>.</p>
<h2 id="the-module">The Module<a hidden class="anchor" aria-hidden="true" href="#the-module">#</a></h2>
<p>The goal of the PowerShell module isn&rsquo;t to recreate the wheel, rather, simply take advantage of what is already available. The only thing I needed to do was to find a way to streamline it into my daily routines. The obvious choice for me was a PowerShell module&hellip;because&hellip;PowerShell! The available functions mimick what is currently available in the <a href="https://docs.emailrep.io/">API Docs</a> and as new endpoints are added more functions may be added to the module. Here are the current functions and what they are used for.</p>
<h3 id="ps-get-emailrep">PS&gt; Get-EmailRep<a hidden class="anchor" aria-hidden="true" href="#ps-get-emailrep">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">❯</span> Get-EmailRep bill@microsoft.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>email                      <span style="color:#960050;background-color:#1e0010">:</span> bill@microsoft.com
</span></span><span style="display:flex;"><span>reputation                 <span style="color:#960050;background-color:#1e0010">:</span> high
</span></span><span style="display:flex;"><span>suspicious                 <span style="color:#960050;background-color:#1e0010">:</span> False
</span></span><span style="display:flex;"><span>references                 <span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#ae81ff">85</span>
</span></span><span style="display:flex;"><span>blacklisted                <span style="color:#960050;background-color:#1e0010">:</span> False
</span></span><span style="display:flex;"><span>malicious_activity         <span style="color:#960050;background-color:#1e0010">:</span> False
</span></span><span style="display:flex;"><span>malicious_activity_recent  <span style="color:#960050;background-color:#1e0010">:</span> False
</span></span><span style="display:flex;"><span>credentials_leaked         <span style="color:#960050;background-color:#1e0010">:</span> True
</span></span><span style="display:flex;"><span>credentials_leaked_recent  <span style="color:#960050;background-color:#1e0010">:</span> False
</span></span><span style="display:flex;"><span>data_breach                <span style="color:#960050;background-color:#1e0010">:</span> True
</span></span><span style="display:flex;"><span>first_seen                 <span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#ae81ff">07</span>/<span style="color:#ae81ff">01</span>/<span style="color:#ae81ff">2008</span>
</span></span><span style="display:flex;"><span>last_seen                  <span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#ae81ff">10</span>/<span style="color:#ae81ff">16</span>/<span style="color:#ae81ff">2019</span>
</span></span><span style="display:flex;"><span>domain_exists              <span style="color:#960050;background-color:#1e0010">:</span> True
</span></span><span style="display:flex;"><span>domain_reputation          <span style="color:#960050;background-color:#1e0010">:</span> high
</span></span><span style="display:flex;"><span>new_domain                 <span style="color:#960050;background-color:#1e0010">:</span> False
</span></span><span style="display:flex;"><span>days_since_domain_creation <span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#ae81ff">10512</span>
</span></span><span style="display:flex;"><span>suspicious_tld             <span style="color:#960050;background-color:#1e0010">:</span> False
</span></span><span style="display:flex;"><span>spam                       <span style="color:#960050;background-color:#1e0010">:</span> False
</span></span><span style="display:flex;"><span>free_provider              <span style="color:#960050;background-color:#1e0010">:</span> False
</span></span><span style="display:flex;"><span>disposable                 <span style="color:#960050;background-color:#1e0010">:</span> False
</span></span><span style="display:flex;"><span>deliverable                <span style="color:#960050;background-color:#1e0010">:</span> True
</span></span><span style="display:flex;"><span>accept_all                 <span style="color:#960050;background-color:#1e0010">:</span> True
</span></span><span style="display:flex;"><span>valid_mx                   <span style="color:#960050;background-color:#1e0010">:</span> True
</span></span><span style="display:flex;"><span>spoofable                  <span style="color:#960050;background-color:#1e0010">:</span> False
</span></span><span style="display:flex;"><span>spf_strict                 <span style="color:#960050;background-color:#1e0010">:</span> True
</span></span><span style="display:flex;"><span>dmarc_enforced             <span style="color:#960050;background-color:#1e0010">:</span> True
</span></span><span style="display:flex;"><span>profiles                   <span style="color:#960050;background-color:#1e0010">:</span> {twitter, vimeo, pinterest, angellist...}
</span></span></code></pre></div><p>This function does a GET query against the EmailRep API to collect what is already known, if anything, about the email address. In this case, <a href="mailto:bill@microsoft.com">bill@microsoft.com</a> has several different peices of enrichment data that could help determine the reputation of the address. Now, most of this information is simply information and it is up to you to determine what you do with that information. In this case, EmailRep believes the reputation of this address to be &ldquo;high&rdquo;, but that does not mean that it is &ldquo;good&rdquo; or &ldquo;trusted&rdquo;. This simply means that there is enough information about address that it has a reputation.</p>
<blockquote>
<p>How can I use this information?</p></blockquote>
<p>Well, lets take a look at the following:</p>
<pre tabindex="0"><code>blacklisted                : False
malicious_activity         : False
malicious_activity_recent  : False
credentials_leaked         : True
credentials_leaked_recent  : False
data_breach                : True
</code></pre><p>This information indicates that while there are no reports of malicious activity on the account there are reports that it has been listed in recent breach reports or credential leaks. This is important to consider when allowing this account to interact with users in your environment or with your services. It is possible that the account is in possession of a malicious actor and does not have the best of intentions. This may trigger you to look further into the account or require additional verification before proceeding.</p>
<p>These indicators are what I find very useful when triaging phishing emails:</p>
<pre tabindex="0"><code>domain_exists              : True
domain_reputation          : high
new_domain                 : False
days_since_domain_creation : 10512
</code></pre><p>A quick look at the domain details helps identify if this is a newly created domain and what the current reputation on that domain is. Often times, we will see that phishing emails are originating from domains that are only hours, or sometimes minutes, old. This typically an indicator of malicious activity.</p>
<p>You can take a look at the meaning of each attribute by heading over to the <a href="https://docs.emailrep.io/technical-reference/reference/email/getemail">API Docs</a>.</p>
<h3 id="ps-new-emailrep">PS&gt; New-EmailRep<a hidden class="anchor" aria-hidden="true" href="#ps-new-emailrep">#</a></h3>
<p>This function is used to report email addresses to the EmailRep API. It does require an API key and you can request one over at <a href="https://emailrep.io/key">EmailRep&rsquo;s site</a>.</p>
<p>An example report would look like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>New-EmailRep -Email bill@microsoft.com `
</span></span><span style="display:flex;"><span>     -Tags bec,credential_phishing `
</span></span><span style="display:flex;"><span>     -Description <span style="color:#e6db74">&#39;Compromised account sending Sharepoint login page clone&#39;</span> `
</span></span><span style="display:flex;"><span>     -APIKey <span style="color:#e6db74">&#39;4a534f4e20697320626574746572207468616e20584d4c21&#39;</span>
</span></span></code></pre></div><p>This will report to EmailRep that <a href="mailto:bill@microsoft.com">bill@microsoft.com</a> has been involved in a <a href="https://www.trendmicro.com/vinfo/us/security/definition/business-email-compromise-(bec)">Business Email Compromise</a> and is sending credential phishing via fake Sharepoint login pages.</p>
<p>While the EmailRep API does not yet allow you to review these reports once they are submitted it is certainly on the road map. Having access to this data will greatly improve the accuracy of the determined &lsquo;reputation&rsquo; of the email address.</p>
<h3 id="ps-set-emailrep">PS&gt; Set-EmailRep<a hidden class="anchor" aria-hidden="true" href="#ps-set-emailrep">#</a></h3>
<p>This function is used to save your API key to your user profile so you do not need to include it on every execution. Currently, this utilized PowerShell&rsquo;s <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/convertto-securestring?view=powershell-7">secure string</a> capabilities to encrypt the key in an XML file for later retrieval (each time Get-EmailRep or New-EmailRep is called). This key can only be read by the user that set it thanks to <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/convertfrom-securestring?view=powershell-7#description">Windows DPAPI</a>. DPAPI is also a great topic to discuss. I learned a lot about how it is used and the risk it introduces&hellip;but that is for another day.</p>
<p>To use <code>set-emailrep</code> simply run the command and enter in your APIKey. If you have previously ran this command it will alert you and ask if you would like to overwrite the existing entry.</p>
<h2 id="final-thoughts">Final Thoughts<a hidden class="anchor" aria-hidden="true" href="#final-thoughts">#</a></h2>
<p>This has been a learning process and opened up many new rabbit holes to follow. I plan on continueing to share these as I tackle them. Hopefully somebody out there will find it useful. I know I wouldn&rsquo;t be where I am at without the contributions that others have made to the community. It is by their encouragement that I want to share my experiences as well and return the favor. Let me know what you think and if you have any questions about PSEmailRep!</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">My Website</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
